<ion-header>
  <ion-toolbar>
    <ion-title>billing</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid>
    <ion-row>
      <ng-container *ngIf="role === 'operator' || role === 'employee'">

        <ion-col size="12">
          <ion-item lines="full" style="--background:'#5bb362';border-radius: 10px; color:white;border-right:30px solid rgb(81, 126, 75)">
             <p>Total Sale :  <B>&#x20B9; {{total}}</B></p>
          </ion-item>
        </ion-col>
        <ion-col size="6">
          <ion-item lines="full"  style="--background:'#527592';border-radius: 10px; color:white;border-right:30px solid rgb(77, 77, 124)">
             <p>Product Sales <br/> <B>&#x20B9; {{productTotal}}</B></p>
          </ion-item>
        </ion-col>
        <ion-col size="6">
          <ion-item lines="full"  style="--background:'#527592';border-radius: 10px; color:white;border-right:30px solid rgb(77, 77, 124)">
             <p>Service Sales <br/> <B>&#x20B9; {{serviceTotal}}</B></p>
          </ion-item>
        </ion-col>
      </ng-container>

      <ng-container *ngIf="role==='admin'">
              <ion-col size="12">
        <ion-searchbar placeholder="Search by Customer Name/No" [(ngModel)]="search" name="search" (ionChange)="searchedText()" mode="md"></ion-searchbar>
      </ion-col>
        <ion-col size="4">
          <ion-item lines="full" style="--background:'#527592';border-radius: 10px; color:white;">
             <p style="font-size: 12px;">Total <br/> <B>&#x20B9; {{total}}</B></p>
          </ion-item>
        </ion-col>
        <ion-col size="4">
          <ion-item lines="full"  style="--background:'#527592';border-radius: 10px; color:white;">
             <p style="font-size: 12px;">Product <br/> <B>&#x20B9; {{productTotal}}</B></p>
          </ion-item>
        </ion-col>
        <ion-col size="4">
          <ion-item lines="full"  style="--background:'#527592';border-radius: 10px; color:white;">
             <p style="font-size: 12px;">Service <br/> <B>&#x20B9; {{serviceTotal}}</B></p>
          </ion-item>
        </ion-col>
      </ng-container>
      <ng-container *ngIf="role === 'operator'">
        
        <ion-col size="6">
          <ion-item lines="full">
            <ionic-selectable placeholder="Payment Mode" [(ngModel)]="selectedPaymentMode" [items]="payment" itemValueField="id"
              itemTextField="name" [canSearch]="true" (onChange)="paymentChange($event)" headerColor="danger">
        
              <ng-template ionicSelectableCloseButtonTemplate>
                <ion-icon name="close-circle"></ion-icon>
              </ng-template>
        
              <ng-template ionicSelectableTitleTemplate>
                Payment Mode
              </ng-template>
        
            </ionic-selectable>
          </ion-item>
        </ion-col>
        <ion-col size="6">
          <ion-item lines="full">
            <ionic-selectable placeholder="Employee" [(ngModel)]="selectedEmployee" [items]="employeeList" itemValueField="user_id"
              itemTextField="name" [canSearch]="true" (onChange)="employeeChange($event)" headerColor="danger">
        
              <ng-template ionicSelectableCloseButtonTemplate>
                <ion-icon name="close-circle"></ion-icon>
              </ng-template>
        
              <ng-template ionicSelectableTitleTemplate>
                Select Employee
              </ng-template>
        
            </ionic-selectable>
          </ion-item>
        </ion-col>
      </ng-container>
      <ng-container *ngIf="role === 'admin'">
        
        <ion-col size="4">
          <ion-item lines="full">
            <ionic-selectable placeholder="Payment" [(ngModel)]="selectedPaymentMode" [items]="payment" itemValueField="id"
              itemTextField="name" [canSearch]="true" (onChange)="paymentChange($event)" headerColor="danger">
        
              <ng-template ionicSelectableCloseButtonTemplate>
                <ion-icon name="close-circle"></ion-icon>
              </ng-template>
        
              <ng-template ionicSelectableTitleTemplate>
                Payment
              </ng-template>
        
            </ionic-selectable>
          </ion-item>
        </ion-col>
        <ion-col size="4">
          <ion-item lines="full">
            <ionic-selectable placeholder="Employee" [(ngModel)]="selectedEmployee" [items]="employeeList" itemValueField="user_id"
              itemTextField="name" [canSearch]="true" (onChange)="employeeChange($event)" headerColor="danger">
              <ng-template ionicSelectableCloseButtonTemplate>
                <ion-icon name="close-circle"></ion-icon>
              </ng-template>
        
              <ng-template ionicSelectableTitleTemplate>
                Employee
              </ng-template>
        
            </ionic-selectable>
          </ion-item>
        </ion-col>
        <ion-col size="4">
          <ion-item lines="full">
            <ionic-selectable placeholder="Branch" [(ngModel)]="selectedBranch" [items]="branchList" itemValueField="id"
              itemTextField="name" [canSearch]="true" (onChange)="branchChange($event)" headerColor="danger">
        
              <ng-template ionicSelectableCloseButtonTemplate>
                <ion-icon name="close-circle"></ion-icon>
              </ng-template>
        
              <ng-template ionicSelectableTitleTemplate>
                Branch
              </ng-template>
        
            </ionic-selectable>
          </ion-item>
        </ion-col>
        <ion-col size="6">
          <ion-datetime [placeholder]="startDate" [pickerOptions]="startDateOption"  [max]="today" ></ion-datetime>
        </ion-col>
        <ion-col size="6">
          <ion-datetime [placeholder]="endDate" [pickerOptions]="endDateOption" [max]="today"></ion-datetime>
        </ion-col>
      </ng-container>
      <ng-container *ngIf="role === 'employee'">
        <ion-col size="12">
          <ion-item lines="full">
            <ionic-selectable placeholder="Payment Mode" [(ngModel)]="selectedPaymentMode" [items]="payment" itemValueField="id"
              itemTextField="name" [canSearch]="true" (onChange)="paymentChange($event)" headerColor="danger">
        
              <ng-template ionicSelectableCloseButtonTemplate>
                <ion-icon name="close-circle"></ion-icon>
              </ng-template>
        
              <ng-template ionicSelectableTitleTemplate>
                Payment Mode
              </ng-template>
        
            </ionic-selectable>
          </ion-item>
        </ion-col>
      </ng-container>

    </ion-row>
  </ion-grid>

     <ng-container *ngIf="billArray.length>0; else noidea">
       
       <ion-list *ngFor="let item of billArray | filter: 'customer_name,customer_phone' :search">
      <ion-item lines="full">
      <ion-label>

        <h2 slot="start">{{item?.customer_name?item?.customer_name:'Not Mentioned'}}</h2>
        <p><b>Token No: {{item.token_id}}</b></p>
        <p><b>Bill No: {{item.bill_id}}</b></p>
        <ng-container *ngIf="role === 'operator' || role==='admin'">

          <p><b>Cost: &#x20B9; {{item.total_price}}</b></p>
        </ng-container>
        <ng-container *ngIf="role === 'employee'">
          <p><b>Your Sale: &#x20B9; {{item.total_price}}</b></p>
        </ng-container>
        <ng-container *ngIf="role==='operator' || role==='admin'">
          <ion-button mode="ios" size="small" color="tertiary" routerLink="/edit-bill"  [queryParams]="{id:item.bill_id}">
            <ion-icon slot="start" mode="md" name="create"></ion-icon>
            Edit
          </ion-button>
          <ion-button mode="ios" size="small" color="tertiary" routerLink="/con/billing-view" [queryParams]="{id:item.bill_id}">
            <ion-icon slot="start" mode="md" name="eye"></ion-icon>
            View
          </ion-button>
        </ng-container>
        <ng-container *ngIf="role==='admin'">

          <ion-button mode="ios" size="small" color="danger" (click)="deleteAppointment(item.bill_id)">
            <ion-icon slot="start" mode="md" name="trash"></ion-icon>
            Delete
          </ion-button>
        </ng-container>
      </ion-label>

    </ion-item>
        </ion-list>
</ng-container>
<ng-template #noidea>
  <ion-item lines="none" class="mar" mode="ios" detail="false" rippleEffect="true">

    <ion-label style="color: #2c3847;font-weight:'bold'" class="ion-text-center">No Bills For Today</ion-label>
 
  </ion-item>
  
</ng-template>
</ion-content>